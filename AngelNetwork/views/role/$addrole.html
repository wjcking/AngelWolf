<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="content/jquery-3.5.1.min.js"></script>
    <script src="content/utils.js"></script>
    <!-- [if lt IE 9]>
     <script src="content/json2.js" type="text/javascript"></script>
      <![endif]-->
    <link href="content/site.css" rel="stylesheet" />
    <script src="content/role_category.js"></script>

    <script src="content/handlers.js"></script>
    <script src="content/role.js"></script>
</head>
<body>
    角色选择：<br />
    <div id="divRoles"></div>
    姓名： 
    <input id="role_name" type="text" />
    <input id="role_id" type="hidden" value="0" />
    关联：
      <input id="role_parent_name" type="text" />
    <input id="role_parent_id" type="hidden" value="0" />

    <!--  <select id="role_parent_id">
       <option value="0">未知</option>
    </select>-->
    <br />
    <!--真主-->
    描述：  
    <textarea id="role_desc" cols="20" rows="2"></textarea>
    <br />
    <!--二子-->
    分类：
    <select id="role_category">
        <option value="0">未知</option>

    </select>
    优先级：
    <select id="role_priority">
        <option value="-1">测试数据</option>
        <option value="0">未知</option>
        <option value="1">疼痛感</option>
        <option value="2">who</option>
        <option value="3">by whom</option>
    </select>
    <br />
    <input id="btnAddRole" type="button" value="添加角色" />
    <br />
    优先级：
    <select id="incident_prioity">
        <option value="-1">测试</option>
        <option value="0">未知</option>
        <option value="1">疼痛感</option>
        <option value="2">who</option>
        <option value="3">by whom</option>
    </select>
    <br />
    描述：
    <br />
    <textarea id="incident_desc" cols="20" rows="2"></textarea>
    <br />
    <!--郎咸平-->
    <input id="btnAddIncident" type="button" value="添加事件" />
    <div id="divResult"></div>

    <script src="content/role_extend.js"></script>
    <script type="text/javascript">
        //var roleInfo = role.getInfo();
        var role = new Role();
        var categoryInfo = role.getCategoryInfo();
        //添加角色信息
        function addRoleInfo(name) {
            var json = role.getInfo();
            json.name = name
            alert(name);
            Handlers.handler.set(json,
                function (data) {
                    $("#divResult").html(data);
                },
                function (xhr, state, errorThrown) {
                    var error = xhr.status + xhr.readyState + xhr.statusText + xhr.responseText + errorThrown;
                    $("#divResult").append(error);
                });
        }


        //获得角色分类
               for (var item in RoleCategory) {
                   $("#role_category").append(
                       String.format("<option value=\"{0}\">{1}</option>", RoleCategory[item].id, RoleCategory[item].name)
                   );
        }

        //获得角色二列表
        Handlers.handler.get({ name: "role", type: "list" },
            function (data) {
                for (var item in data) {
                    var href = "<a href=\"###\" class=\"role\" id=\"{0}\" title=\"{1}\">({0}){1}</a>";
                    href += "<a href=\"###\"  class=\"role_parent\" id=\"{0}\" title=\"{1}\"> 关联|</a>";
                    href = String.format(href, data[item].id, data[item].name);

                    $("#divRoles").append(href);
                }
                $(".role").click(function () {

                    $("#role_name").val(this.title);
                    $("#role_id").val(this.id);


                    return false;
                });
                $(".role_parent").click(function () {

                    $("#role_parent_name").val(this.title);
                    $("#role_parent_id").val(this.id);
                    return false;
                });

            },
            function (xhr, state, errorThrown) {
                var error = xhr.status + xhr.readyState + xhr.statusText + xhr.responseText + errorThrown;
                $("#divResult").append(error);
            });

        //when loaded sucessfully then bind
        $("#btnAddRole").click(function () {

            addRoleInfo("role");
        });
        $("#btnAddIncident").click(function () {
            addRoleInfo("incident");
        });
    </script>

</body>
</html>
